<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Проверка статуса разбана</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e6ebef;
      padding: 2rem;
      margin: 0;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input,
    textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      font-family: monospace;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.7rem 1rem;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #45a049;
    }
    #result {
      margin-top: 1.5rem;
      font-size: 1.2rem;
      font-weight: bold;
      min-height: 2em;
      white-space: pre-wrap;
    }

    /* Цвета статусов */
    .status-approved {
      color: green;
      font-weight: bold;
    }
    .status-review {
      color: orange;
      font-weight: bold;
    }
    .status-denied {
      color: red;
      font-weight: bold;
    }
    .status-perm {
      color: black;
      font-weight: bolder;
    }

    .admin-section {
      margin-top: 3rem;
      border-top: 1px solid #ddd;
      padding-top: 2rem;
      display: none; /* скрываем по умолчанию */
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Проверка статуса разбана</h2>
    <label for="nickname">Ник игрока</label>
    <input type="text" id="nickname" placeholder="Введите ник..." />
    <button onclick="checkStatus()">Проверить</button>
    <div id="result"></div>

    <div>
      <label for="adminPasswordCheck">Введите пароль для доступа к админ-панели</label>
      <input type="password" id="adminPasswordCheck" placeholder="Пароль администратора" />
      <button onclick="showAdminPanel()">Войти</button>
      <div id="loginStatus" style="color:red; margin-top:0.5rem;"></div>
    </div>

    <div class="admin-section" id="adminSection">
      <h3>Админ-панель (только для тебя)</h3>
      <label for="adminPassword">Пароль администратора (для сохранения данных)</label>
      <input type="password" id="adminPassword" placeholder="Введите пароль" />
      <label for="dataInput">Данные игроков (JSON)</label>
      <textarea
        id="dataInput"
        rows="10"
        placeholder='{"Player1": {"status": "Одобрено", "unban_at": "2025-05-25T16:00:00Z"}}'
      ></textarea>
      <button onclick="saveData()">Сохранить</button>
      <div id="adminStatus"></div>
    </div>
  </div>

  <script>
    const adminPassword = "BVNt539greek7BV98";
    let players = {};

    async function loadData() {
      try {
        const response = await fetch("data.json");
        players = await response.json();
      } catch (e) {
        console.error("Ошибка загрузки JSON:", e);
      }
    }

    async function checkStatus() {
      if (Object.keys(players).length === 0) await loadData();

      const nickname = document.getElementById("nickname").value.trim().toLowerCase();
      const resultDiv = document.getElementById("result");

      const entry = Object.entries(players).find(([key]) => key.toLowerCase() === nickname)?.[1];
      
      const now = new Date();
      let output = "";

      if (!entry) {
        output = "Игрок не найден или чистый.";
        resultDiv.className = "";
      } else {
        const statusLower = entry.status.toLowerCase();
        let statusClass = "";
        if (statusLower === "одобрено") statusClass = "status-approved";
        else if (statusLower === "на рассмотрении") statusClass = "status-review";
        else if (statusLower === "отклонено") statusClass = "status-denied";
        else if (statusLower === "пермач") statusClass = "status-perm";

        if (statusLower === "пермач") {
          output = `${nickname}: Бессрочная блокировка`;
          resultDiv.className = statusClass;
        } else {
          if (!entry.unban_at) {
            output = `${nickname}: Информация о дате разбана отсутствует.`;
            resultDiv.className = "";
          } else {
            const unbanDate = new Date(entry.unban_at);
            const timeDiff = unbanDate - now;

            if (timeDiff <= 0) {
              const passedSinceUnban = (now - unbanDate) / 1000 / 60 / 60 / 24;
              if (passedSinceUnban >= 3) {
                output = `${nickname}: Чисто, нет приостановки.`;
                resultDiv.className = "";
              } else {
                output = `${nickname}: ${entry.status}, разбан уже был.`;
                resultDiv.className = statusClass;
              }
            } else {
              const totalHours = Math.floor(timeDiff / 1000 / 60 / 60);
              const days = Math.floor(totalHours / 24);
              const hours = totalHours % 24;
              output = `${nickname}: ${entry.status}, до разбана: ${days} дн. ${hours} ч.`;
              resultDiv.className = statusClass;
            }
          }
        }
      }
      resultDiv.innerText = output;
    }

    function saveData() {
      const pass = document.getElementById("adminPassword").value;
      const status = document.getElementById("adminStatus");

      if (pass !== adminPassword) {
        status.innerText = "❌ Неверный пароль!";
        return;
      }

      try {
        const newData = JSON.parse(document.getElementById("dataInput").value);
        players = newData;
        status.innerText = "✅ Данные обновлены (но сохранятся только в этой сессии).";
      } catch (e) {
        status.innerText = "❌ Ошибка в JSON формате.";
      }
    }

    function showAdminPanel() {
      const passInput = document.getElementById("adminPasswordCheck");
      const loginStatus = document.getElementById("loginStatus");
      const adminSection = document.getElementById("adminSection");

      if (passInput.value === adminPassword) {
        adminSection.style.display = "block";
        loginStatus.innerText = "";
        passInput.value = "";
      } else {
        loginStatus.innerText = "❌ Неверный пароль!";
        adminSection.style.display = "none";
      }
    }
  </script>
</body>
</html>
