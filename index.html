<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Проверка статуса разбана</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #d1d5db; /* приятный мягкий серый фон */
      padding: 2rem;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #f9fafb; /* чуть светлее */
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      color: #222;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input,
    textarea,
    select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      font-family: monospace;
      box-sizing: border-box;
    }
    button {
      margin-top: 1rem;
      padding: 0.7rem 1rem;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background: #45a049;
    }
    #result {
      margin-top: 1.5rem;
      font-size: 1.2rem;
      font-weight: bold;
      min-height: 2em;
      white-space: pre-wrap;
    }

    /* Цвета статусов с обводкой */
    .status-approved {
      color: green;
      font-weight: bold;
      border: 2px solid #4caf50;
      padding: 0.15rem 0.4rem;
      border-radius: 5px;
      display: inline-block;
    }
    .status-review {
      color: orange;
      font-weight: bold;
      border: 2px solid #ffb547;
      padding: 0.15rem 0.4rem;
      border-radius: 5px;
      display: inline-block;
      animation: pulse 2s infinite;
    }
    .status-denied {
      color: red;
      font-weight: bold;
      border: 2px solid #f44336;
      padding: 0.15rem 0.4rem;
      border-radius: 5px;
      display: inline-block;
    }
    .status-perm {
      color: darkred;
      font-weight: bolder;
      border: 2px solid darkred;
      padding: 0.15rem 0.4rem;
      border-radius: 5px;
      display: inline-block;
    }
    .status-tempban {
      color: darkred;
      font-weight: bold;
      border: 2px solid #d32f2f;
      padding: 0.15rem 0.4rem;
      border-radius: 5px;
      display: inline-block;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 5px 0 rgba(255,165,0, 0.7);
      }
      50% {
        box-shadow: 0 0 15px 5px rgba(255,165,0, 0.9);
      }
      100% {
        box-shadow: 0 0 5px 0 rgba(255,165,0, 0.7);
      }
    }

    .admin-section {
      margin-top: 3rem;
      border-top: 1px solid #bbb;
      padding-top: 2rem;
    }
    .player-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.3rem 0;
      border-bottom: 1px solid #eee;
      font-family: monospace;
    }
    .player-nick {
      cursor: pointer;
      color: #1565c0;
      text-decoration: underline;
    }
    .admin-controls {
      display: flex;
      gap: 0.3rem;
      align-items: center;
    }
    .admin-controls button {
      padding: 0.2rem 0.5rem;
      font-size: 0.85rem;
      border-radius: 4px;
    }
    .btn-approve {
      background-color: #4caf50;
      color: white;
      border: none;
    }
    .btn-deny {
      background-color: #f44336;
      color: white;
      border: none;
    }
    .btn-review {
      background-color: #ffb547;
      color: black;
      border: none;
    }
    .btn-sm {
      padding: 0.15rem 0.4rem;
      font-size: 0.8rem;
    }
    .custom-days-input {
      width: 70px;
      margin-left: 8px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Проверка статуса разбана</h2>
    <label for="nickname">Ник игрока</label>
    <input type="text" id="nickname" placeholder="Введите ник..." />
    <button onclick="checkStatus()">Проверить</button>
    <div id="result"></div>

    <div class="admin-section" id="adminSection" style="display:none;">
      <h3>Админ-панель (только для тебя)</h3>
      <label for="adminPassword">Пароль администратора</label>
      <input type="password" id="adminPassword" placeholder="Введите пароль" />
      <button onclick="loginAdmin()">Войти</button>
      <div id="adminStatus" style="margin-top: 0.5rem; font-weight: bold;"></div>
      
      <div id="adminPanel" style="margin-top: 1.5rem; display:none;">
        <h4>Управление банами</h4>
        <div id="playersList"></div>
      </div>
    </div>
  </div>

  <script>
    let players = {
      "PlayerOne": { status: "tempban", unban_at: new Date(Date.now() + 3*24*3600*1000).toISOString() },
      "PlayerTwo": { status: "perm", unban_at: null },
      "PlayerThree": { status: "review", unban_at: null },
      "PlayerFour": { status: "denied", unban_at: null },
      "PlayerFive": { status: "approved", unban_at: null }
    };

    let isAdmin = false;
    const ADMIN_PASSWORD = "BVNt539greek7BV98";

    function statusClass(status) {
      switch(status) {
        case "approved": return "status-approved";
        case "review": return "status-review";
        case "denied": return "status-denied";
        case "perm": return "status-perm";
        case "tempban": return "status-tempban";
        default: return "";
      }
    }

    function formatDate(d) {
      return d.toLocaleDateString() + " " + d.toLocaleTimeString();
    }

    function checkStatus() {
      const nickInput = document.getElementById("nickname").value.trim();
      if(!nickInput) {
        alert("Введите ник игрока");
        return;
      }
      const nickLower = nickInput.toLowerCase();
      let foundKey = null;
      for (const key in players) {
        if (key.toLowerCase() === nickLower) {
          foundKey = key;
          break;
        }
      }
      const resultDiv = document.getElementById("result");
      if (!foundKey) {
        resultDiv.textContent = "Игрок не найден или чистый.";
        resultDiv.className = "";
        return;
      }
      const entry = players[foundKey];
      let text = "";
      if (entry.status === "perm") {
        text = `${foundKey}: Бессрочная блокировка`;
      } else if (entry.status === "tempban") {
        const now = new Date();
        const unban = new Date(entry.unban_at);
        const diffMs = unban - now;
        if(diffMs <= 0) {
          text = `${foundKey}: Бан истек`;
        } else {
          const days = Math.floor(diffMs / (24*3600*1000));
          const hours = Math.floor((diffMs % (24*3600*1000)) / (3600*1000));
          text = `${foundKey}: Временный бан, до разбана осталось: ${days} дн. ${hours} ч.`;
        }
      } else if (entry.status === "review") {
        text = `${foundKey}: Бан на рассмотрении...`;
      } else if (entry.status === "approved") {
        text = `${foundKey}: Бан одобрен (разбан)`;
      } else if (entry.status === "denied") {
        text = `${foundKey}: Апелляция отклонена, бан активен`;
      } else {
        text = `${foundKey}: Статус неизвестен`;
      }
      resultDiv.textContent = text;
      resultDiv.className = statusClass(entry.status);
    }

    function loginAdmin() {
      const pwd = document.getElementById("adminPassword").value;
      const statusDiv = document.getElementById("adminStatus");
      if(pwd === ADMIN_PASSWORD) {
        isAdmin = true;
        statusDiv.textContent = "Вы вошли как админ";
        document.getElementById("adminPanel").style.display = "block";
        renderPlayersList();
      } else {
        isAdmin = false;
        statusDiv.textContent = "Неверный пароль";
        document.getElementById("adminPanel").style.display = "none";
      }
    }

    function renderPlayersList() {
      if(!isAdmin) return;
      const container = document.getElementById("playersList");
      container.innerHTML = "";

      // Перебираем игроков, которые забанены или на рассмотрении или отклонены
      const filteredPlayers = Object.entries(players).filter(([nick, data]) =>
        data.status === "perm" || data.status === "tempban" || data.status === "review" || data.status === "denied"
      );

      if(filteredPlayers.length === 0) {
        container.textContent = "Нет забаненных или на рассмотрении.";
        return;
      }

      filteredPlayers.forEach(([nick, data]) => {
        const div = document.createElement("div");
        div.className = "player-row";

        // Ник с кликабельностью
        const nickSpan = document.createElement("span");
        nickSpan.textContent = nick;
        nickSpan.className = "player-nick";
        nickSpan.title = "Кликни для смягчения срока (если бан на рассмотрении)";
        nickSpan.onclick = () => {
          if(data.status === "review") {
            let newDays = prompt("Введите новый срок бана в днях (целое число > 0):");
            if(newDays) {
              newDays = parseInt(newDays);
              if(isNaN(newDays) || newDays < 1) {
                alert("Введите корректное число дней!");
                return;
              }
              players[nick].status = "tempban";
              players[nick].unban_at = new Date(Date.now() + newDays*24*3600*1000).toISOString();
              renderPlayersList();
            }
          } else {
            alert("Смягчение срока возможно только для статуса 'на рассмотрении'");
          }
        };

        div.appendChild(nickSpan);

        // Статус с цветом
        const statusSpan = document.createElement("span");
        statusSpan.textContent = data.status === "perm" ? "Бессрочная блокировка" :
                               data.status === "tempban" ? `Временный бан до ${new Date(data.unban_at).toLocaleDateString()}` :
                               data.status === "review" ? "На рассмотрении" :
                               data.status === "denied" ? "Отклонено" :
                               data.status === "approved" ? "Одобрен" :
                               "Неизвестно";
        statusSpan.className = statusClass(data.status);
        div.appendChild(statusSpan);

        // Админ кнопки управления
        const controls = document.createElement("div");
        controls.className = "admin-controls";

        // Селект с сроками бана
        const select = document.createElement("select");
        select.dataset.nick = nick;
        select.className = "select-term";
        select.onchange = termChange;

        // Опции сроков
        const options = [
          { val: "0", text: "Разбанить (одобрено)" },
          { val: "1", text: "1 день" },
          { val: "2", text: "2 дня" },
          { val: "3", text: "3 дня" },
          { val: "7", text: "7 дней" },
          { val: "14", text: "14 дней" },
          { val: "30", text: "30 дней" },
          { val: "perm", text: "Бессрочный бан" },
          { val: "custom", text: "Другой..." }
        ];
        options.forEach(opt => {
          const o = document.createElement("option");
          o.value = opt.val;
          o.textContent = opt.text;
          select.appendChild(o);
        });

        // Устанавливаем текущий выбранный вариант
        if(data.status === "perm") {
          select.value = "perm";
        } else if(data.status === "tempban") {
          // Ищем подходит ли unban_at к одному из вариантов дней (с точностью +-1 день)
          const now = Date.now();
          const diffDays = Math.round((new Date(data.unban_at) - now) / (24*3600*1000));
          let found = false;
          for(let i = 1; i <= 30; i++) {
            if(Math.abs(diffDays - i) <= 1) {
              select.value = i.toString();
              found = true;
              break;
            }
          }
          if(!found) select.value = "custom";
        } else if(data.status === "review") {
          select.value = "custom"; // Чтобы показать поле ввода для смягчения (пользователь может ввести)
        } else {
          select.value = "0"; // Разбан
        }

        controls.appendChild(select);

        // Поле для кастомного ввода дней
        const customInput = document.createElement("input");
        customInput.type = "number";
        customInput.min = 1;
        customInput.placeholder = "Дни";
        customInput.className = "custom-days-input";
        customInput.dataset.nick = nick;
        customInput.onchange = customDaysChanged;

        // Показываем поле если выбран custom
        if(select.value === "custom") {
          customInput.style.display = "inline-block";
          if(data.status === "tempban" && data.unban_at) {
            const now = Date.now();
            const diffDays = Math.round((new Date(data.unban_at) - now) / (24*3600*1000));
            customInput.value = diffDays > 0 ? diffDays : "";
          } else {
            customInput.value = "";
          }
        }
        controls.appendChild(customInput);

        // Кнопка отклонить апелляцию (оставить бан)
        const btnDeny = document.createElement("button");
        btnDeny.textContent = "Отклонить";
        btnDeny.className = "btn-deny btn-sm";
        btnDeny.onclick = () => {
          if(confirm(`Отклонить апелляцию игрока ${nick}?`)) {
            players[nick].status = "denied";
            renderPlayersList();
          }
        };
        controls.appendChild(btnDeny);

        div.appendChild(controls);
        container.appendChild(div);
      });
    }

    function termChange(event) {
      if(!isAdmin) return;
      const select = event.target;
      const nick = select.dataset.nick;
      const val = select.value;
      const input = document.querySelector(`input.custom-days-input[data-nick="${nick}"]`);

      if(val === "custom") {
        if(input) {
          input.style.display = "inline-block";
          input.value = "";
        }
      } else {
        if(input) input.style.display = "none";

        if(val === "0") {
          players[nick].status = "approved";
          players[nick].unban_at = null;
        } else if(val === "perm") {
          players[nick].status = "perm";
          players[nick].unban_at = null;
        } else {
          const days = parseInt(val);
          if(days && days > 0) {
            players[nick].status = "tempban";
            players[nick].unban_at = new Date(Date.now() + days*24*3600*1000).toISOString();
          }
        }
        renderPlayersList();
      }
    }

    function customDaysChanged(event) {
      if(!isAdmin) return;
      const input = event.target;
      const nick = input.dataset.nick;
      let days = parseInt(input.value);
      if(isNaN(days) || days < 1) {
        alert("Введите корректное число дней (целое, больше 0).");
        return;
      }
      players[nick].status = "tempban";
      players[nick].unban_at = new Date(Date.now() + days*24*3600*1000).toISOString();
      renderPlayersList();
    }
  </script>
</body>
</html>
